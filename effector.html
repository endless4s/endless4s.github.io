<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="Scala library to describe event sourced entities using tagless-final algebras, running with built-in implementations for Akka.">
<meta property="og:title" content="Endless4s">
<meta property="og:description" content="Scala library to describe event sourced entities using tagless-final algebras, running with built-in implementations for Akka.">
<meta property="og:image" content="https://endless4s.github.io/logo-open-graph.png">
<meta name="generator" content="Paradox, paradox-material-theme=0.7.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="Scala library to describe event sourced entities using tagless-final algebras, running with built-in implementations for Akka.">
<link rel="shortcut icon" href="favicon.png">
<title>Effector Â· </title>
<link rel="stylesheet" href="assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="assets/stylesheets/application-palette.22915126.css">
<meta name="theme-color" content="#546e7a" />
<link rel="stylesheet" href="lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="lib/prettify/prettify.css">
<script src="assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Overpass:300,400,400i,700|Overpass+Mono">
<style>
body,input{font-family:"Overpass","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Overpass Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="assets/fonts/font-awesome.css">
<link rel="stylesheet" href="assets/fonts/material-icons.css">
<link rel="stylesheet" href="assets/stylesheets/paradox-material-theme.css">
</head>
<body
data-md-color-primary="blue-grey"
data-md-color-accent="red"
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="index.html" title="" class="md-header-nav__button md-logo">
<img src="logo-symbol-only.svg" width="24" height="24">
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
</span>
<span class="md-header-nav__topic">
Effector
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/endless4s/endless"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
endless4s/endless
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="index.html" title="" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<img src="logo-symbol-only.svg" width="24" height="24">
</a>
<a href="index.html" title="">
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/endless4s/endless"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
endless4s/endless
</div>
</a>

</div>
<ul>
  <li><a href="getting-started.html" class="page">Getting Started</a></li>
  <li><a href="nutshell.html" class="page">In a nutshell</a></li>
  <li><a href="abstractions.html" class="page">Abstractions</a>
  <ul>
    <li><a href="sharding.html" class="page">Sharding</a></li>
    <li><a href="entity.html" class="page">Entity</a></li>
    <li><a href="durable-entity.html" class="page">Durable entity</a></li>
    <li><a href="applier.html" class="page">EventApplier</a></li>
    <li><a href="protocol.html" class="page">CommandProtocol</a></li>
    <li><a href="sender.html" class="page">CommandSender</a></li>
    <li><a href="side-effect.html" class="page">Side-effect</a></li>
    <li><a href="effector.html" class="active page">Effector</a></li>
    <li><a href="name.html" class="page">EntityNameProvider</a></li>
    <li><a href="id.html" class="page">EntityIDCodec</a></li>
    <li><a href="deployer.html" class="page">Deployer</a></li>
  </ul></li>
  <li><a href="runtime.html" class="page">Pekko and Akka runtimes</a></li>
  <li><a href="example.html" class="page">Example app</a></li>
  <li><a href="transactions.html" class="page">Transactions</a></li>
  <li><a href="reference.html" class="page">Reference</a></li>
  <li><a href="inspiration.html" class="page">Inspiration</a></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="effector.html#effector" class="header">Effector</a>
  <ul>
    <li><a href="effector.html#state-derived-side-effects" class="header">State-derived side-effects</a></li>
    <li><a href="effector.html#passivation" class="header">Passivation</a></li>
    <li><a href="effector.html#self-process-definition" class="header">Self &amp; process definition</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.31.0
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="effector.html#effector" class="header">Effector</a>
  <ul>
    <li><a href="effector.html#state-derived-side-effects" class="header">State-derived side-effects</a></li>
    <li><a href="effector.html#passivation" class="header">Passivation</a></li>
    <li><a href="effector.html#self-process-definition" class="header">Self &amp; process definition</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#effector" name="effector" class="anchor"><span class="anchor-link"></span></a>Effector</h1>
<pre class="prettyprint"><code class="language-scala">trait StateReader[F[_], S] {
  def read: F[Option[S]]
}
trait Passivator[F[_]] {
  def enablePassivation(after: FiniteDuration = Duration.Zero): F[Unit]
  def disablePassivation: F[Unit]
}
trait Self[F[_], Alg[_[_]]] {
  def self: Alg[F]
}
trait Effector[F[_], S] extends StateReader[F, S] with Passivator[F] with Self[F]
</code></pre>
<p><a href="api/core/endless/core/entity/Effector.html" title="endless.core.entity.Effector"><code>Effector</code></a> is a typeclass used to describe side effects in the context of a <a href="side-effect.html">SideEffect</a> definition.</p>
<h2><a href="#state-derived-side-effects" name="state-derived-side-effects" class="anchor"><span class="anchor-link"></span></a>State-derived side-effects</h2>
<p><a href="api/core/endless/core/entity/StateReader.html" title="endless.core.entity.StateReader"><code>StateReader</code></a> allows reading the updated entity state after event persistence or recovery. </p>
<h2><a href="#passivation" name="passivation" class="anchor"><span class="anchor-link"></span></a>Passivation</h2>
<p><a href="api/core/endless/core/entity/Passivator.html" title="endless.core.entity.Passivator"><code>Passivator</code></a> allow fine grain control over passivation. In certain domains, entities can evolve into &ldquo;dormant&rdquo; states (e.g. after a <code>BookingCancelled</code> event) for which it is beneficial to trigger passivation, either immediately or after a certain delay. This enables proactive optimization of cluster resources.</p>
<h2><a href="#self-process-definition" name="self-process-definition" class="anchor"><span class="anchor-link"></span></a>Self &amp; process definition</h2>
<p><a href="api/core/endless/core/entity/Self.html" title="endless.core.entity.Self"><code>Self</code></a> exposes the algebra of the entity. This allows definition of asynchronous processes that involve interaction with the very same entity, typically to define entities acting as <a href="https://www.infoq.com/news/2017/07/process-managers-event-flows/">process managers</a> (see below for more detail). </p><div class="callout note tip"><div class="callout-title">At least once delivery with zero latency</div>
<p>For most processes, <em>at least once</em> delivery guarantees are required. This can be achieved with a projection, however at the cost of some incurred latency. Actual latency depends on the database and event journal implementation used, as well as the projection throughput. One must also make sure to distribute the projection across the cluster to avoid creating a central choke point. Even so, if a projector process gets stalled for some reason, this can create a cascade effect with events pending processing building up. </p>
<p>An effective alternative to using a projection is to track process completion in the entity state itself. Launching asynchronous operations directly as a side-effect of an event has zero latency overhead and also the added advantage that the process launches within the node of the entity which triggered it, thus benefiting from inherent distribution. </p>
<p>By enabling <a href="https://pekko.apache.org/docs/pekko/current/typed/cluster-sharding.html#remembering-entities"><em>remember-entities</em></a>, we can achieve guaranteed <em>at-least-once</em> completion of asynchronous processes thanks to effector running right after recovery (thus withstanding node crash or shard rebalancing).</p>
<p><em>endless</em> makes it easy to implement this pattern with <code>Self</code>. Here&rsquo;s the recipe, as illustrated in the example application <a href="https://github.com/endless4s/endless/tree/v0.31.0/example/src/main/scala/endless/example/logic/BookingSideEffect.scala">example</a>:</p>
<ol>
  <li><code>BookingPlaced</code> event gets persisted. At this point, entity state represents pending acceptation of the booking <code>Booking(..., status = Pending)</code></li>
  <li>Effector function inspects the state, and in case of <code>Pending</code> status, asks a third-party service for availability and notifies the entity of the result:</li>
</ol>
<pre class="prettyprint"><code class="language-scala">val availabilityProcess: Booking =&gt; F[Unit] = booking =&gt;
  booking.status match {
    case Status.Pending =&gt;
      (availabilityAlg.isCapacityAvailable(
        booking.time,
        booking.passengerCount
      ) &gt;&gt;= self.notifyCapacity).void
    case _ =&gt; ().pure
  }
</code></pre>
<p>3.<code>BookingAccepted</code> or <code>BookingRejected</code> events are persisted and entity state is updated accordingly.</p></div>
</div>
<div>
<a href="https://github.com/endless4s/endless/tree/v0.31.0/documentation/src/main/paradox/effector.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.31.0
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="side-effect.html" title="Side-effect" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Side-effect
</span>
</div>
</a>
<a href="name.html" title="EntityNameProvider" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
EntityNameProvider
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://sbt.github.io/sbt-paradox-material-theme/">Paradox Material Theme</a>

</div>
<div class="md-footer-social">
<a href="https://github.com/endless4s/endless" class="md-footer-social__link fa fa-github"></a>
</div>

</div>
</div>
</footer>

</div>
<script src="assets/javascripts/application.583bbe55.js"></script>
<script src="assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"."}})</script>
<script type="text/javascript" src="lib/prettify/prettify.js"></script>
<script type="text/javascript" src="lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
<script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","G-KKHFXG4VB4"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})});if(document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>

</body>
</html>